<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interview Report - AI Assessment Dashboard</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background-color: #f8fafc;
        min-height: 100vh;
        color: #334155;
        position: relative;
        overflow-x: hidden;
      }

      .bg-overlay {
        display: none;
      }

      /* Header - Professional */
      .header {
        background: #ffffff;
        border-bottom: 1px solid #e2e8f0;
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
      }

      .nav-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        color: #0f172a;
        font-weight: 700;
        font-size: 20px;
        transition: none;
      }

      .logo:hover {
        color: #0f172a;
      }

      .logo-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 16px;
        box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
        border: none;
      }

      .logo-icon:hover {
        transform: none;
        box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
      }

      .nav-actions {
        display: flex;
        gap: 1rem;
        align-items: center;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
      }

      .btn-primary {
        background: #2563eb;
        color: white;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        border: 1px solid transparent;
      }

      .btn-primary:hover {
        background: #1d4ed8;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }

      .btn-secondary {
        background: #ffffff;
        color: #475569;
        border: 1px solid #cbd5e1;
        backdrop-filter: none;
      }

      .btn-secondary:hover {
        background: #f1f5f9;
        border-color: #94a3b8;
        color: #1e293b;
        transform: translateY(-1px);
      }

      /* Main Content */
      .main-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
        display: grid;
        grid-template-columns: 1fr 350px;
        gap: 2rem;
      }

      .content-area {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      /* Card Base Styles */
      .card {
        background: #ffffff;
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #e2e8f0;
        position: relative;
        overflow: hidden;
        transition: box-shadow 0.2s ease;
      }

      .card::before {
        display: none;
      }

      .card:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }

      /* Interview Summary Card */
      .interview-summary {
        grid-column: 1 / -1;
      }

      .summary-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 2rem;
        gap: 2rem;
      }

      .candidate-info {
        flex: 1;
      }

      .candidate-name {
        font-size: 2rem;
        font-weight: 700;
        color: #0f172a;
        margin-bottom: 0.5rem;
      }

      .candidate-details {
        display: flex;
        gap: 2rem;
        margin-bottom: 1rem;
      }

      .detail-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #64748b;
        font-weight: 500;
        font-size: 0.9rem;
      }

      .detail-item svg {
        color: #94a3b8;
      }

      .overall-score {
        text-align: center;
        min-width: 200px;
      }

      .score-circle {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: conic-gradient(
          from 0deg,
          #10b981 0deg,
          #10b981 var(--percentage),
          #f1f5f9 var(--percentage),
          #f1f5f9 360deg
        );
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        position: relative;
      }

      .score-circle::before {
        content: "";
        width: 90px;
        height: 90px;
        background: white;
        border-radius: 50%;
        position: absolute;
      }

      .score-value {
        font-size: 2rem;
        font-weight: 800;
        color: #0f172a;
        z-index: 1;
      }

      .score-label {
        font-size: 0.875rem;
        color: #64748b;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Status Badge */
      .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: capitalize;
        letter-spacing: normal;
        margin-top: 0.5rem;
      }

      .status-recommended {
        background: #dcfce7;
        color: #166534;
        border: 1px solid #bbf7d0;
        box-shadow: none;
      }

      .status-not-recommended {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fecaca;
        box-shadow: none;
      }

      .status-review {
        background: #fef3c7;
        color: #92400e;
        border: 1px solid #fde68a;
        box-shadow: none;
      }

      /* Skill Scores Grid */
      .skills-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
      }

      .skill-item {
        background: #f8fafc;
        padding: 1.25rem;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        border-left: none;
      }

      .skill-item.technical {
        border-top: 3px solid #3b82f6;
      }

      .skill-item.communication {
        border-top: 3px solid #10b981;
      }

      .skill-item.problem-solving {
        border-top: 3px solid #f59e0b;
      }

      .skill-item.cultural {
        border-top: 3px solid #8b5cf6;
      }

      .skill-item.experience {
        border-top: 3px solid #0ea5e9;
      }

      .skill-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
      }

      .skill-name {
        font-size: 0.95rem;
        font-weight: 600;
        color: #334155;
      }

      .skill-score {
        font-size: 1.1rem;
        font-weight: 700;
        color: #0f172a;
      }

      .skill-bar {
        width: 100%;
        height: 8px;
        background: #e2e8f0;
        border-radius: 4px;
        overflow: hidden;
      }

      .skill-progress {
        height: 100%;
        border-radius: 4px;
        transition: width 1s ease-out;
        animation: fill-bar 1s ease-out;
        box-shadow: none;
      }

      .skill-item.technical .skill-progress {
        background: #3b82f6;
      }

      .skill-item.communication .skill-progress {
        background: #10b981;
      }

      .skill-item.problem-solving .skill-progress {
        background: #f59e0b;
      }

      .skill-item.cultural .skill-progress {
        background: #8b5cf6;
      }

      .skill-item.experience .skill-progress {
        background: #0ea5e9;
      }

      @keyframes fill-bar {
        from {
          width: 0;
        }
      }

      /* Executive Summary */
      .executive-summary {
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: 12px;
        padding: 1.5rem;
        margin: 1.5rem 0;
      }

      .executive-summary h3 {
        color: #0369a1;
        margin-bottom: 0.75rem;
        font-size: 1.1rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .executive-summary p {
        color: #0c4a6e;
        line-height: 1.6;
        font-size: 0.95rem;
        white-space: normal;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }

      /* Strengths & Concerns */
      .assessment-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin: 2rem 0;
      }

      .assessment-section h3 {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #1e293b;
      }

      .strengths h3 {
        color: #166534;
      }

      .concerns h3 {
        color: #991b1b;
      }

      .assessment-list {
        list-style: none;
      }

      .assessment-list li {
        padding: 0.75rem;
        margin: 0.5rem 0;
        border-radius: 8px;
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        font-size: 0.95rem;
        line-height: 1.5;
        white-space: normal;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }

      .strengths .assessment-list li {
        background: #f0fdf4;
        border: 1px solid #bbf7d0;
        color: #14532d;
        border-left: 3px solid #22c55e;
      }

      .concerns .assessment-list li {
        background: #fef2f2;
        border: 1px solid #fecaca;
        color: #7f1d1d;
        border-left: 3px solid #ef4444;
      }

      /* Sidebar */
      .sidebar {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .sidebar .card {
        padding: 1.5rem;
      }

      .sidebar h3 {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: #0f172a;
      }

      /* Interview Details */
      .detail-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem 0;
        border-bottom: 1px solid #f1f5f9;
      }

      .detail-row:last-child {
        border-bottom: none;
      }

      .detail-label {
        font-weight: 500;
        color: #64748b;
        font-size: 0.875rem;
      }

      .detail-value {
        font-weight: 600;
        color: #0f172a;
        font-size: 0.9rem;
      }

      /* Charts */
      .chart-container {
        position: relative;
        height: 200px;
        margin: 1rem 0;
      }

      /* Actions */
      .actions-card .btn {
        width: 100%;
        justify-content: center;
        margin-bottom: 0.75rem;
      }

      /* Experience Relevance Badge */
      .experience-relevance {
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        border-radius: 12px;
        padding: 1.25rem;
        margin: 1.5rem 0;
      }

      .experience-relevance h3 {
        color: #0369a1;
        margin-bottom: 1rem;
        font-size: 1.1rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .experience-score-display {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .experience-score-value {
        font-size: 2rem;
        font-weight: 800;
        color: #0c4a6e;
        min-width: 60px;
      }

      .experience-bar-container {
        flex: 1;
        background: #e0f2fe;
        height: 10px;
        border-radius: 5px;
        overflow: hidden;
        position: relative;
      }

      .experience-bar-fill {
        height: 100%;
        background: #0ea5e9;
        border-radius: 5px;
        transition: width 1s ease-out;
        box-shadow: none;
      }

      /* Follow-Up Badge */
      .follow-up-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: capitalize;
        letter-spacing: normal;
      }

      .follow-up-required {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #fecaca;
        box-shadow: none;
      }

      .follow-up-not-required {
        background: #dcfce7;
        color: #166534;
        border: 1px solid #bbf7d0;
        box-shadow: none;
      }

      /* Notable Quotes Section */
      .quotes-section {
        margin: 2rem 0;
      }

      .quotes-section h3 {
        font-size: 1.1rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: #1e293b;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .quote-block {
        background: #fffbeb;
        border-left: 3px solid #f59e0b;
        border-radius: 8px;
        padding: 1.25rem 1.25rem 1.25rem 2rem;
        margin: 1rem 0;
        position: relative;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        animation: slideInUp 0.6s ease-out;
      }

      .quote-block::before {
        content: '"';
        position: absolute;
        top: 20px;
        left: 10px;
        font-size: 2.5rem;
        color: #f59e0b;
        opacity: 0.4;
        font-family: Georgia, serif;
        line-height: 1;
      }

      .quote-text {
        color: #92400e;
        font-size: 0.95rem;
        line-height: 1.6;
        font-style: italic;
        position: relative;
        z-index: 1;
        white-space: normal;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }

      .quote-empty {
        color: #64748b;
        font-style: italic;
        text-align: center;
        padding: 2rem;
        background: #f8fafc;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
      }

      /* Follow-Up Section */
      .follow-up-section {
        margin: 2rem 0;
        background: #fff7ed;
        border: 1px solid #ffedd5;
        border-radius: 12px;
        padding: 1.5rem;
      }

      .follow-up-section h3 {
        color: #ea580c;
        margin-bottom: 1rem;
        font-size: 1.1rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .follow-up-content {
        background: white;
        padding: 1rem;
        border-radius: 8px;
        border-left: 3px solid #f97316;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
      }

      .follow-up-content p {
        color: #c2410c;
        line-height: 1.6;
        margin: 0;
        font-size: 0.95rem;
        white-space: normal;
        word-wrap: break-word;
        overflow-wrap: break-word;
      }

      /* Animations */
      .card {
        animation: none;
      }

      .fade-in {
        animation: fadeIn 0.5s ease-out;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Loading state */
      .loading {
        text-align: center;
        padding: 3rem;
        color: #64748b;
      }

      .spinner {
        width: 32px;
        height: 32px;
        border: 3px solid #e2e8f0;
        border-top: 3px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }

      /* PDF-specific styles */
      @media print {
        body {
          background: white;
          margin: 0;
          padding: 0;
        }

        .header,
        .actions-card {
          display: none !important;
        }

        .main-container {
          display: block !important;
          max-width: 100% !important;
          width: 100% !important;
          padding: 0 !important;
          margin: 0 !important;
        }

        .content-area,
        .sidebar {
          width: 100% !important;
          max-width: 100% !important;
          display: block !important;
        }

        .card {
          page-break-inside: avoid;
          break-inside: avoid;
          margin-bottom: 15px;
          overflow: visible !important;
        }

        .assessment-grid {
          page-break-inside: avoid;
          break-inside: avoid;
        }

        .skill-item,
        .quote-block {
          page-break-inside: avoid;
          break-inside: avoid;
        }

        .assessment-list li {
          page-break-inside: avoid;
          break-inside: avoid;
        }

        /* Force text wrapping to multiple lines */
        * {
          word-wrap: break-word !important;
          overflow-wrap: break-word !important;
          word-break: break-word !important;
          white-space: normal !important;
          overflow: visible !important;
          text-overflow: clip !important;
        }

        /* Ensure content wraps properly */
        .executive-summary p,
        .quote-text,
        .assessment-list li,
        .follow-up-content p,
        .detail-value,
        .candidate-name,
        h1, h2, h3, h4, h5, h6,
        p, span, div {
          max-width: 100% !important;
          white-space: normal !important;
          word-wrap: break-word !important;
          overflow-wrap: break-word !important;
          word-break: break-word !important;
          overflow: visible !important;
          text-overflow: clip !important;
        }

        /* Specific fixes for score displays and long text */
        .score-value,
        .skill-score,
        .detail-value,
        .experience-score-value {
          display: block !important;
          max-width: 100% !important;
          overflow: visible !important;
          white-space: normal !important;
          word-wrap: break-word !important;
        }

        /* Ensure flex containers don't cause overflow */
        .detail-row,
        .skill-header,
        .summary-header {
          display: flex !important;
          flex-wrap: wrap !important;
          overflow: visible !important;
        }

        /* Make sure text in flex items wraps */
        .detail-row > *,
        .skill-header > * {
          max-width: 100% !important;
          flex-shrink: 1 !important;
          min-width: 0 !important;
        }
      }

      /* Responsive */
      @media (max-width: 1200px) {
        .main-container {
          grid-template-columns: 1fr;
          gap: 1.5rem;
        }

        .sidebar {
          order: -1;
        }
      }

      @media (max-width: 768px) {
        .main-container {
          padding: 1rem;
        }

        .summary-header {
          flex-direction: column;
          gap: 1rem;
        }

        .candidate-details {
          flex-direction: column;
          gap: 0.5rem;
        }

        .skills-grid {
          grid-template-columns: 1fr;
        }

        .assessment-grid {
          grid-template-columns: 1fr;
        }

        .candidate-name {
          font-size: 1.75rem;
        }
      }
    </style>
  </head>

  <body>
    <div class="bg-overlay"></div>

    <!-- Header -->
    <header class="header">
      <div class="nav-container">
        <div class="logo">
          <div class="logo-icon">AI</div>
          Interview Report
        </div>
        <div class="nav-actions">
          <a href="admin_dashboard.html" class="btn btn-secondary">
            <svg
              width="16"
              height="16"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
              />
            </svg>
            Admin Dashboard
          </a>
          <a href="interview.html" class="btn btn-primary">
            <svg
              width="16"
              height="16"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 4v16m8-8H4"
              />
            </svg>
            New Interview
          </a>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
      <div class="content-area">
        <!-- Interview Summary Card -->
        <div class="card interview-summary">
          <div id="loadingState" class="loading">
            <div class="spinner"></div>
            <p>Loading interview report...</p>
          </div>

          <div id="reportContent" style="display: none">
            <div class="summary-header">
              <div class="candidate-info">
                <h1 class="candidate-name" id="candidateName">John Doe</h1>
                <div class="candidate-details">
                  <div class="detail-item">
                    <svg
                      width="16"
                      height="16"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                      />
                    </svg>
                    <span id="candidateEmail">john@example.com</span>
                  </div>
                  <div class="detail-item">
                    <svg
                      width="16"
                      height="16"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0H8m8 0v2M8 6V4m0 2v2m8-2v2"
                      />
                    </svg>
                    <span id="position">Software Developer</span>
                  </div>
                  <div class="detail-item">
                    <svg
                      width="16"
                      height="16"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                      />
                    </svg>
                    <span id="interviewDuration">25 minutes</span>
                  </div>
                </div>
                <div
                  id="recommendationBadge"
                  class="status-badge status-recommended"
                >
                  Recommended for Hire
                </div>
              </div>

              <div class="overall-score">
                <div class="score-circle" id="scoreCircle">
                  <div class="score-value" id="overallScore">8.5</div>
                </div>
                <div class="score-label">Overall Score</div>
              </div>
            </div>

            <!-- Executive Summary -->
            <div class="executive-summary">
              <h3>
                <svg
                  width="20"
                  height="20"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                  />
                </svg>
                Executive Summary
              </h3>
              <p id="executiveSummary">
                The candidate demonstrates strong technical skills and
                problem-solving abilities. Communication is clear and
                professional. Shows good understanding of software development
                principles and best practices.
              </p>
            </div>

            <!-- Skills Assessment -->
            <div class="skills-grid">
              <div class="skill-item technical">
                <div class="skill-header">
                  <div class="skill-name">Technical Skills</div>
                  <div class="skill-score" id="technicalScore">8.5</div>
                </div>
                <div class="skill-bar">
                  <div class="skill-progress" id="technicalProgress"></div>
                </div>
              </div>

              <div class="skill-item communication">
                <div class="skill-header">
                  <div class="skill-name">Communication</div>
                  <div class="skill-score" id="communicationScore">9.0</div>
                </div>
                <div class="skill-bar">
                  <div class="skill-progress" id="communicationProgress"></div>
                </div>
              </div>

              <div class="skill-item problem-solving">
                <div class="skill-header">
                  <div class="skill-name">Problem Solving</div>
                  <div class="skill-score" id="problemSolvingScore">7.5</div>
                </div>
                <div class="skill-bar">
                  <div class="skill-progress" id="problemSolvingProgress"></div>
                </div>
              </div>

              <div class="skill-item cultural">
                <div class="skill-header">
                  <div class="skill-name">Cultural Fit</div>
                  <div class="skill-score" id="culturalFitScore">8.0</div>
                </div>
                <div class="skill-bar">
                  <div class="skill-progress" id="culturalFitProgress"></div>
                </div>
              </div>

              <div class="skill-item experience">
                <div class="skill-header">
                  <div class="skill-name">Experience Relevance</div>
                  <div class="skill-score" id="experienceRelevanceScore">
                    8.0
                  </div>
                </div>
                <div class="skill-bar">
                  <div
                    class="skill-progress"
                    id="experienceRelevanceProgress"
                  ></div>
                </div>
              </div>
            </div>

            <!-- Notable Quotes -->
            <div class="quotes-section">
              <h3>
                <svg
                  width="20"
                  height="20"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
                  />
                </svg>
                Notable Quotes
              </h3>
              <div id="quotesContainer">
                <div class="quote-block">
                  <p class="quote-text">
                    Sample quote from the interview will appear here.
                  </p>
                </div>
              </div>
            </div>

            <!-- Follow-Up Required -->
            <div
              class="follow-up-section"
              id="followUpSection"
              style="display: none"
            >
              <h3>
                <svg
                  width="20"
                  height="20"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                  />
                </svg>
                Follow-Up Required
              </h3>
              <div class="follow-up-content" id="followUpContent">
                <p>No follow-up required.</p>
              </div>
            </div>

            <!-- Strengths & Concerns -->
            <div class="assessment-grid">
              <div class="strengths">
                <h3>
                  <svg
                    width="20"
                    height="20"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                    />
                  </svg>
                  Key Strengths
                </h3>
                <ul class="assessment-list" id="strengthsList">
                  <li>Strong technical foundation</li>
                  <li>Clear communication skills</li>
                  <li>Problem-solving approach</li>
                </ul>
              </div>

              <div class="concerns">
                <h3>
                  <svg
                    width="20"
                    height="20"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"
                    />
                  </svg>
                  Areas of Concern
                </h3>
                <ul class="assessment-list" id="concernsList">
                  <li>Limited experience with advanced frameworks</li>
                  <li>Could improve system design knowledge</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="sidebar">
        <!-- Interview Details -->
        <div class="card">
          <h3 style="margin-bottom: 1rem; color: #1e293b; font-size: 1.25rem">
            Interview Details
          </h3>
          <div class="detail-row">
            <span class="detail-label">Date</span>
            <span class="detail-value" id="interviewDate">Today</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Duration</span>
            <span class="detail-value" id="duration">25:30</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Interviewer</span>
            <span class="detail-value">AI Assistant</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Type</span>
            <span class="detail-value">Technical</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Status</span>
            <span class="detail-value" style="color: #10b981">Completed</span>
          </div>
        </div>

        <!-- Performance Chart -->
        <div class="card">
          <h3 style="margin-bottom: 1rem; color: #1e293b; font-size: 1.25rem">
            Performance Overview
          </h3>
          <div class="chart-container">
            <canvas id="performanceChart"></canvas>
          </div>
        </div>

        <!-- Actions -->
        <div class="card actions-card">
          <h3 style="margin-bottom: 1rem; color: #1e293b; font-size: 1.25rem">
            Actions
          </h3>
          <button class="btn btn-primary" onclick="downloadReport()">
            <svg
              width="16"
              height="16"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
            Download Report
          </button>

          <button class="btn btn-secondary" onclick="scheduleFollowUp()">
            <svg
              width="16"
              height="16"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
              />
            </svg>
            Schedule Follow-up
          </button>

          <button class="btn btn-secondary" onclick="shareReport()">
            <svg
              width="16"
              height="16"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"
              />
            </svg>
            Share Report
          </button>
        </div>
      </div>
    </main>

    <!-- Selective Security Controls Removed -->

    <script>
      class InterviewerDashboard {
        constructor() {
          this.candidateData = {};
          this.init();
        }

        init() {
          setTimeout(() => {
            this.loadInterviewData();
          }, 1000);
        }

        async loadInterviewData() {
          const urlParams = new URLSearchParams(window.location.search);
          const candidateId = urlParams.get("candidate") || "latest";

          if (candidateId === "latest" || candidateId === "current") {
            this.candidateData = this.getMockData();
            this.displayReport();
            this.initializeCharts();
          } else {
            await this.fetchCandidateData(candidateId);
          }
        }

        async fetchCandidateData(candidateId) {
          try {
            console.log("Fetching candidate data for ID:", candidateId);

            const response = await fetch(
              `${window.location.origin}/api/admin/candidates/${candidateId}`,
              {
                method: "GET",
                headers: {
                  "Content-Type": "application/json",
                },
              }
            );

            if (!response.ok) {
              console.error("Failed to fetch candidate:", response.status);
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const record = await response.json();
            console.log("Fetched candidate record:", record);

            this.candidateData = {
              candidateName: record.fields.candidateName || "Unknown Candidate",
              candidateEmail: record.fields.candidateEmail || "N/A",
              position: record.fields.positionApplied || "N/A",
              interviewDate: record.fields.reportGeneratedAt
                ? new Date(record.fields.reportGeneratedAt).toLocaleDateString()
                : new Date().toLocaleDateString(),
              interviewDuration: record.fields.interviewDuration || "N/A",
              overallScore: parseFloat(record.fields.overallScore) || 0,
              technicalScore:
                parseFloat(record.fields.technicalSkillsScore) || 0,
              communicationScore:
                parseFloat(record.fields.communicationScore) || 0,
              problemSolvingScore:
                parseFloat(record.fields.problemSolvingScore) || 0,
              culturalFitScore: parseFloat(record.fields.culturalFitScore) || 0,
              experienceRelevanceScore:
                parseFloat(record.fields.experienceRelevanceScore) || 0,
              followUpRequired: record.fields.followUpRequired || false,
              recommendation: this.mapStatusToRecommendation(
                record.fields.status
              ),
              executiveSummary:
                record.fields.executiveSummary || "No summary available.",
              strengths: this.parseQuotesField(record.fields.strengths) || [
                "Strong technical foundation",
              ],
              concerns: this.parseQuotesField(record.fields.concerns) || [
                "No concerns noted",
              ],
              notableQuotes:
                this.parseQuotesField(record.fields.RelatedQuotes) || [],
            };

            this.displayReport();
            this.initializeCharts();
          } catch (error) {
            console.error("Error fetching candidate data:", error);
            this.candidateData = this.getMockData();
            this.displayReport();
            this.initializeCharts();
          }
        }

        mapStatusToRecommendation(status) {
          if (!status) return "review";
          const statusLower = status.toLowerCase();
          if (
            statusLower.includes("select") ||
            statusLower.includes("recommend")
          ) {
            return "recommended";
          } else if (statusLower.includes("reject")) {
            return "not-recommended";
          }
          return "review";
        }

        parseArrayField(field) {
          if (!field) return null;
          if (Array.isArray(field)) return field;
          if (typeof field === "string") {
            try {
              const parsed = JSON.parse(field);
              if (Array.isArray(parsed)) return parsed;
            } catch (e) {
              return field
                .split(/[,;\n]/)
                .map((item) => item.trim())
                .filter((item) => item.length > 0);
            }
          }
          return [field.toString()];
        }

        parseQuotesField(field) {
          if (!field) return [];
          if (Array.isArray(field)) return field;
          if (typeof field === "string") {
            try {
              const parsed = JSON.parse(field);
              if (Array.isArray(parsed)) return parsed;
            } catch (e) {
              let quotes = [];

              if (field.includes("\n\n")) {
                quotes = field
                  .split(/\n\n+/)
                  .map((q) => q.trim())
                  .filter((q) => q.length > 0);
              } else if (/^\d+\./.test(field.trim())) {
                quotes = field
                  .split(/\n?\d+\.\s*/)
                  .map((q) => q.trim())
                  .filter((q) => q.length > 0);
              } else if (field.includes("\n- ") || field.includes("\n• ")) {
                quotes = field
                  .split(/\n[-•]\s*/)
                  .map((q) => q.trim())
                  .filter((q) => q.length > 0);
              } else if (field.includes(".,")) {
                quotes = field
                  .split(/\.,\s*/)
                  .map((q) => q.trim())
                  .filter((q) => q.length > 0);
                quotes = quotes.map((q, index) => {
                  if (index < quotes.length - 1 && !q.endsWith(".")) {
                    return q + ".";
                  }
                  return q;
                });
              } else {
                quotes = [
                  field.replace(/\n/g, " ").replace(/\s+/g, " ").trim(),
                ];
              }

              return quotes.filter((q) => q.length > 0);
            }
          }
          return [field.toString()];
        }

        getMockData() {
          return {
            candidateName: "Sarah Johnson",
            candidateEmail: "sarah.johnson@email.com",
            position: "Senior Frontend Developer",
            interviewDate: new Date().toLocaleDateString(),
            interviewDuration: "28:45",
            overallScore: 8.7,
            technicalScore: 9.0,
            communicationScore: 8.5,
            problemSolvingScore: 8.0,
            culturalFitScore: 9.0,
            experienceRelevanceScore: 8.5,
            followUpRequired:
              "Clarify candidate's hands-on coding skills and deeper knowledge of asynchronous operations and exception handling.",
            recommendation: "recommended",
            executiveSummary:
              "Sarah demonstrates exceptional frontend development skills with strong React and TypeScript expertise. Her communication is clear and professional, and she shows excellent problem-solving abilities. She would be a great addition to the team.",
            strengths: [
              "Deep understanding of React ecosystem",
              "Strong TypeScript knowledge",
              "Excellent code architecture decisions",
              "Clear communication style",
              "Good understanding of performance optimization",
            ],
            concerns: [
              "Limited experience with backend technologies",
              "Could benefit from more system design exposure",
            ],
            notableQuotes: [
              "I believe in writing code that's not just functional, but maintainable and scalable for the long term.",
              "Performance optimization is not just about speed, it's about creating a better user experience.",
              "I always approach problems by breaking them down into smaller, manageable pieces.",
            ],
          };
        }

        displayReport() {
          const data = this.candidateData;

          const loadingState = document.getElementById("loadingState");
          const reportContent = document.getElementById("reportContent");
          if (loadingState) loadingState.style.display = "none";
          if (reportContent) reportContent.style.display = "block";

          document.getElementById("candidateName").textContent =
            data.candidateName;
          document.getElementById("candidateEmail").textContent =
            data.candidateEmail;
          document.getElementById("position").textContent = data.position;
          document.getElementById("interviewDuration").textContent =
            data.interviewDuration;
          document.getElementById("interviewDate").textContent =
            data.interviewDate;
          document.getElementById("duration").textContent =
            data.interviewDuration;

          const scoreCircle = document.getElementById("scoreCircle");
          const scoreValue = document.getElementById("overallScore");
          const percentage = (data.overallScore / 10) * 360;

          scoreCircle.style.setProperty("--percentage", `${percentage}deg`);
          scoreValue.textContent = data.overallScore.toFixed(1);

          const badge = document.getElementById("recommendationBadge");
          if (data.recommendation === "recommended") {
            badge.className = "status-badge status-recommended";
            badge.textContent = "Recommended for Hire";
          } else if (data.recommendation === "not-recommended") {
            badge.className = "status-badge status-not-recommended";
            badge.textContent = "Not Recommended";
          } else {
            badge.className = "status-badge status-review";
            badge.textContent = "Requires Review";
          }

          document.getElementById("executiveSummary").textContent =
            data.executiveSummary;

          this.updateSkillScore("technical", data.technicalScore);
          this.updateSkillScore("communication", data.communicationScore);
          this.updateSkillScore("problemSolving", data.problemSolvingScore);
          this.updateSkillScore("culturalFit", data.culturalFitScore);
          this.updateSkillScore(
            "experienceRelevance",
            data.experienceRelevanceScore || 0
          );

          const followUpSection = document.getElementById("followUpSection");
          const followUpContent = document.getElementById("followUpContent");
          const followUpData = data.followUpRequired;

          if (
            followUpData &&
            followUpData !== false &&
            followUpData !== "false" &&
            followUpData !== "No" &&
            followUpData !== "no" &&
            followUpData !== "None" &&
            followUpData.toString().trim().length > 0
          ) {
            followUpSection.style.display = "block";
            followUpContent.innerHTML = `<p>${followUpData}</p>`;
          } else {
            followUpSection.style.display = "none";
          }

          this.displayQuotes(data.notableQuotes || []);

          this.populateList("strengthsList", data.strengths);
          this.populateList("concernsList", data.concerns);
        }

        updateSkillScore(skillType, score) {
          document.getElementById(`${skillType}Score`).textContent =
            score.toFixed(1);
          const progressBar = document.getElementById(`${skillType}Progress`);
          const percentage = (score / 10) * 100;

          setTimeout(() => {
            progressBar.style.width = `${percentage}%`;
          }, 500);
        }

        populateList(listId, items) {
          const list = document.getElementById(listId);
          list.innerHTML = "";

          items.forEach((item) => {
            const li = document.createElement("li");
            li.textContent = item;
            list.appendChild(li);
          });
        }

        displayQuotes(quotes) {
          const container = document.getElementById("quotesContainer");
          container.innerHTML = "";

          if (!quotes || quotes.length === 0) {
            container.innerHTML =
              '<div class="quote-empty">No notable quotes from this interview.</div>';
            return;
          }

          quotes.forEach((quote) => {
            const quoteBlock = document.createElement("div");
            quoteBlock.className = "quote-block";

            const quoteText = document.createElement("p");
            quoteText.className = "quote-text";
            quoteText.textContent = quote;

            quoteBlock.appendChild(quoteText);
            container.appendChild(quoteBlock);
          });
        }

        initializeCharts() {
          const ctx = document
            .getElementById("performanceChart")
            .getContext("2d");

          new Chart(ctx, {
            type: "radar",
            data: {
              labels: [
                "Technical",
                "Communication",
                "Problem Solving",
                "Cultural Fit",
              ],
              datasets: [
                {
                  label: "Performance",
                  data: [
                    this.candidateData.technicalScore,
                    this.candidateData.communicationScore,
                    this.candidateData.problemSolvingScore,
                    this.candidateData.culturalFitScore,
                  ],
                  backgroundColor: "rgba(59, 130, 246, 0.2)",
                  borderColor: "rgba(59, 130, 246, 1)",
                  borderWidth: 2,
                  pointBackgroundColor: "rgba(59, 130, 246, 1)",
                  pointBorderColor: "#fff",
                  pointBorderWidth: 2,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                r: {
                  beginAtZero: true,
                  max: 10,
                  ticks: {
                    stepSize: 2,
                  },
                },
              },
              plugins: {
                legend: {
                  display: false,
                },
              },
            },
          });
        }
      }

      function downloadReport() {
        console.log("Download initiated - Overlay Strategy");
        
        try {
            // Helper to safe get text
            const getText = (id) => {
                const el = document.getElementById(id);
                return el ? el.textContent.trim() : '';
            };

            // Get candidate data with fallbacks
            const candidateName = getText("candidateName") || "Candidate Report";
            const candidateEmail = getText("candidateEmail");
            const position = getText("position");
            const overallScore = getText("overallScore");
            const interviewDate = getText("interviewDate");
            const duration = getText("duration");
            const executiveSummary = getText("executiveSummary");
            
            // Get scores with fallbacks
            const technicalScore = getText("technicalScore") || "0.0";
            const communicationScore = getText("communicationScore") || "0.0";
            const problemSolvingScore = getText("problemSolvingScore") || "0.0";
            const culturalFitScore = getText("culturalFitScore") || "0.0";
            const experienceScore = getText("experienceRelevanceScore") || "0.0";
            
            // Get recommendation
            const recommendation = getText("recommendationBadge") || "Review Required";
            
            // Get strengths and concerns
            const strengthsList = Array.from(document.querySelectorAll('#strengthsList li')).map(li => li.textContent);
            const concernsList = Array.from(document.querySelectorAll('#concernsList li')).map(li => li.textContent);
            
            // Get quotes
            const quotes = Array.from(document.querySelectorAll('.quote-text')).map(q => q.textContent);
            
            // Get follow-up if exists
            const followUpSection = document.getElementById("followUpSection");
            const followUpText = followUpSection && followUpSection.style.display !== 'none' 
              ? document.getElementById("followUpContent").textContent.trim() 
              : null;

            // 1. Create Loading Overlay (Highest Z-Index) to hide the rendering process
            const loadingOverlay = document.createElement('div');
            loadingOverlay.id = 'pdf-loading-overlay';
            loadingOverlay.style.position = 'fixed';
            loadingOverlay.style.top = '0';
            loadingOverlay.style.left = '0';
            loadingOverlay.style.width = '100vw';
            loadingOverlay.style.height = '100vh';
            loadingOverlay.style.background = 'rgba(255, 255, 255, 0.98)';
            loadingOverlay.style.zIndex = '100000'; // Topmost
            loadingOverlay.style.display = 'flex';
            loadingOverlay.style.justifyContent = 'center';
            loadingOverlay.style.alignItems = 'center';
            loadingOverlay.style.flexDirection = 'column';
            loadingOverlay.innerHTML = `
                <div class="spinner" style="width: 50px; height: 50px; border-width: 4px; border-color: #e2e8f0; border-top-color: #3b82f6;"></div>
                <h3 style="margin-top: 20px; color: #0f172a; font-family: 'Inter', sans-serif;">Generatiing PDF Report...</h3>
                <p style="color: #64748b; font-size: 14px; font-family: 'Inter', sans-serif;">Please wait while we format your document.</p>
            `;
            document.body.appendChild(loadingOverlay);

            // 2. Create PDF Container (High Z-Index, but below overlay)
            const pdfContainer = document.createElement('div');
            pdfContainer.id = 'pdf-generation-container';
            // A4 dimensions in px (approximate for screen rendering @ 96dpi)
            // A4 is 210mm x 297mm. 
            // html2pdf default uses mm units.
            pdfContainer.style.width = '794px'; 
            pdfContainer.style.minHeight = '1123px'; 
            pdfContainer.style.padding = '40px';
            pdfContainer.style.backgroundColor = '#ffffff';
            pdfContainer.style.fontFamily = 'Inter, sans-serif';
            pdfContainer.style.color = '#334155';
            
            // IMPORTANT: Place it visibly on screen but covered by key overlay
            // CHANGE: Use absolute positioning instead of fixed.
            // Absolute positioning relative to body is safer for html2canvas to capture correct coordinates.
            pdfContainer.style.position = 'absolute'; 
            pdfContainer.style.top = '0';
            pdfContainer.style.left = '215px';
            pdfContainer.style.margin = '0'; // Strict zero margin
            pdfContainer.style.zIndex = '99999'; // Under overlay
            pdfContainer.style.boxShadow = 'none'; // distinct from debug mode
            
            // Build PDF HTML
            pdfContainer.innerHTML = `
              <div style="text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #2563eb;">
                <h1 style="color: #0f172a; font-size: 28px; margin-bottom: 10px;">Interview Assessment Report</h1>
                <p style="color: #64748b; font-size: 14px;">Generated on ${new Date().toLocaleDateString()}</p>
              </div>
              
              <div style="background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                <h2 style="color: #0f172a; font-size: 24px; margin-bottom: 15px;">${candidateName}</h2>
                <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 10px;">
                  <div style="color: #64748b; font-size: 14px;"><strong>Email:</strong> ${candidateEmail}</div>
                  <div style="color: #64748b; font-size: 14px;"><strong>Position:</strong> ${position}</div>
                </div>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                  <div style="color: #64748b; font-size: 14px;"><strong>Date:</strong> ${interviewDate}</div>
                  <div style="color: #64748b; font-size: 14px;"><strong>Duration:</strong> ${duration}</div>
                </div>
                <div style="margin-top: 15px; padding: 10px 20px; background: ${recommendation.includes('Recommended') ? '#dcfce7' : recommendation.includes('Not') ? '#fee2e2' : '#fef3c7'}; 
                            color: ${recommendation.includes('Recommended') ? '#166534' : recommendation.includes('Not') ? '#991b1b' : '#92400e'}; 
                            border-radius: 20px; display: inline-block; font-weight: 600; font-size: 14px;">
                  ${recommendation}
                </div>
              </div>
              
              <div style="text-align: center; margin: 25px 0; padding: 20px; background: #f0f9ff; border-radius: 8px;">
                <div style="font-size: 48px; font-weight: 800; color: #0f172a; margin-bottom: 5px;">${overallScore}</div>
                <div style="color: #64748b; font-size: 14px; font-weight: 600; text-transform: uppercase;">Overall Score</div>
              </div>
              
              <div style="margin: 25px 0;">
                <h3 style="color: #0369a1; font-size: 18px; margin-bottom: 15px; display: flex; align-items: center;">
                  📋 Executive Summary
                </h3>
                <p style="color: #334155; line-height: 1.8; font-size: 14px; background: #f0f9ff; padding: 15px; border-radius: 8px; border-left: 3px solid #0ea5e9;">
                  ${executiveSummary}
                </p>
              </div>
              
              <div style="margin: 25px 0;">
                <h3 style="color: #0f172a; font-size: 18px; margin-bottom: 15px;">📊 Skills Assessment</h3>
                <table style="width: 100%; border-collapse: collapse;">
                  <tr style="background: #f8fafc;">
                    <td style="padding: 12px; border: 1px solid #e2e8f0; font-weight: 600; color: #334155;">Technical Skills</td>
                    <td style="padding: 12px; border: 1px solid #e2e8f0; text-align: center; font-weight: 700; color: #3b82f6;">${technicalScore}</td>
                  </tr>
                  <tr>
                    <td style="padding: 12px; border: 1px solid #e2e8f0; font-weight: 600; color: #334155;">Communication</td>
                    <td style="padding: 12px; border: 1px solid #e2e8f0; text-align: center; font-weight: 700; color: #10b981;">${communicationScore}</td>
                  </tr>
                  <tr style="background: #f8fafc;">
                    <td style="padding: 12px; border: 1px solid #e2e8f0; font-weight: 600; color: #334155;">Problem Solving</td>
                    <td style="padding: 12px; border: 1px solid #e2e8f0; text-align: center; font-weight: 700; color: #f59e0b;">${problemSolvingScore}</td>
                  </tr>
                  <tr>
                    <td style="padding: 12px; border: 1px solid #e2e8f0; font-weight: 600; color: #334155;">Cultural Fit</td>
                    <td style="padding: 12px; border: 1px solid #e2e8f0; text-align: center; font-weight: 700; color: #8b5cf6;">${culturalFitScore}</td>
                  </tr>
                  <tr style="background: #f8fafc;">
                    <td style="padding: 12px; border: 1px solid #e2e8f0; font-weight: 600; color: #334155;">Experience Relevance</td>
                    <td style="padding: 12px; border: 1px solid #e2e8f0; text-align: center; font-weight: 700; color: #0ea5e9;">${experienceScore}</td>
                  </tr>
                </table>
              </div>
               
              ${quotes.length > 0 ? `
              <div style="margin: 25px 0;">
                <h3 style="color: #0f172a; font-size: 18px; margin-bottom: 15px;">💬 Notable Quotes</h3>
                ${quotes.map(quote => `
                  <div style="background: #fffbeb; border-left: 3px solid #f59e0b; padding: 15px; margin: 10px 0; border-radius: 4px;">
                    <p style="color: #92400e; font-style: italic; font-size: 14px; line-height: 1.6; margin: 0;">"${quote}"</p>
                  </div>
                `).join('')}
              </div>
              ` : ''}
              
              ${followUpText ? `
              <div style="margin: 25px 0; background: #fff7ed; border: 1px solid #ffedd5; border-radius: 8px; padding: 15px;">
                <h3 style="color: #ea580c; font-size: 18px; margin-bottom: 10px;">⚠️ Follow-Up Required</h3>
                <p style="color: #c2410c; font-size: 14px; line-height: 1.6; margin: 0;">${followUpText}</p>
              </div>
              ` : ''}
              
              <div style="margin: 25px 0;">
                <div style="display: inline-block; width: 48%; vertical-align: top; margin-right: 3%;">
                  <h3 style="color: #166534; font-size: 18px; margin-bottom: 15px;">✅ Key Strengths</h3>
                  <ul style="list-style: none; padding: 0; margin: 0;">
                    ${strengthsList.map(strength => `
                      <li style="background: #f0fdf4; border-left: 3px solid #22c55e; padding: 10px; margin: 8px 0; color: #14532d; font-size: 13px; line-height: 1.5;">
                        ${strength}
                      </li>
                    `).join('')}
                  </ul>
                </div>
                <div style="display: inline-block; width: 48%; vertical-align: top;">
                  <h3 style="color: #991b1b; font-size: 18px; margin-bottom: 15px;">⚠️ Areas of Concern</h3>
                  <ul style="list-style: none; padding: 0; margin: 0;">
                    ${concernsList.map(concern => `
                      <li style="background: #fef2f2; border-left: 3px solid #ef4444; padding: 10px; margin: 8px 0; color: #7f1d1d; font-size: 13px; line-height: 1.5;">
                        ${concern}
                      </li>
                    `).join('')}
                  </ul>
                </div>
              </div>
              
            `;
            
            // Append to body
            document.body.appendChild(pdfContainer);

            // Scroll to top to help html2canvas capture from (0,0)
            window.scrollTo(0, 0);
            
            const opt = {
              margin: 10,
              filename: `${candidateName.replace(/\s+/g, "_")}_Interview_Report.pdf`,
              image: { type: "jpeg", quality: 0.98 },
              html2canvas: { 
                scale: 2,
                useCORS: true,
                letterRendering: true,
                scrollY: 0,
                scrollX: 0, // Force start at left edge
                // Removed windowWidth to let it detect natural size, or set to typical desktop
                windowWidth: 1200, 
                height: pdfContainer.scrollHeight // Capture full height
              },
              jsPDF: { 
                unit: "mm", 
                format: "a4", 
                orientation: "portrait"
              }
            };

            if (typeof html2pdf === 'undefined') {
                alert("Error: PDF library not loaded. Please refresh the page.");
                document.body.removeChild(loadingOverlay);
                document.body.removeChild(pdfContainer);
                return;
            }

            // Small delay to ensure rendering is complete
            setTimeout(() => {
                html2pdf()
                  .set(opt)
                  .from(pdfContainer)
                  .save()
                  .then(() => {
                    console.log("PDF Generated successfully");
                    document.body.removeChild(loadingOverlay);
                    document.body.removeChild(pdfContainer);
                  })
                  .catch((err) => {
                    console.error("PDF generation failed:", err);
                    document.body.removeChild(loadingOverlay);
                    if (document.body.contains(pdfContainer)) {
                        document.body.removeChild(pdfContainer);
                    }
                    alert("Failed to generate PDF: " + err.message);
                  });
            }, 1000); // 1 second delay for DOM paint

        } catch (e) {
            console.error("Critical error in downloadReport:", e);
            // Clean up possible overlays
            const overlay = document.getElementById('pdf-loading-overlay');
            const container = document.getElementById('pdf-generation-container');
            if (overlay) overlay.remove();
            if (container) container.remove();
            alert("Error initializing download: " + e.message);
        }
      }

      function scheduleFollowUp() {
        alert("Schedule follow-up functionality would be implemented here");
      }

      function shareReport() {
        if (navigator.share) {
          navigator.share({
            title: "Interview Report",
            text: "Interview report for candidate",
            url: window.location.href,
          });
        } else {
          navigator.clipboard.writeText(window.location.href);
          alert("Report link copied to clipboard");
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        new InterviewerDashboard();
      });
    </script>
  </body>
</html>
